#include "functions.hpp"

#include <gtest/gtest.h>

const static Matrix one = { {
    { 1, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 1, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 1, 0,   0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 1,   0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0 },

    { 0, 0, 0, 0,   1, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 1, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 1, 0,   0, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 1,   0, 0, 0, 0,   0, 0, 0, 0 },

    { 0, 0, 0, 0,   0, 0, 0, 0,   1, 0, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 0,   0, 1, 0, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 1, 0,   0, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 1,   0, 0, 0, 0 },

    { 0,0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0,   1, 0, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0,   0, 1, 0, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 1, 0 },
    { 0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 0,   0, 0, 0, 1 }
} };

const static Matrix A = { {
    {    1,     2,     3,     4,     5,     6,     7,     8,     9,    10,    11,    12,    13,    14,    15,    16 },
    {   17,    18,    19,    20,    21,    22,    23,    24,    25,    26,    27,    28,    29,    30,    31,    32 },
    {   33,    34,    35,    36,    37,    38,    39,    40,    41,    42,    43,    44,    45,    46,    47,    48 },
    {   49,    50,    51,    52,    53,    54,    55,    56,    57,    58,    59,    60,    61,    62,    63,    64 },

    {   65,    66,    67,    68,    69,    70,    71,    72,    73,    74,    75,    76,    77,    78,    79,    80 },
    {   81,    82,    83,    84,    85,    86,    87,    88,    89,    90,    91,    92,    93,    94,    95,    96 },
    {   97,    98,    99,   100,   101,   102,   103,   104,   105,   106,   107,   108,   109,   110,   111,   112 },
    {  113,   114,   115,   116,   117,   118,   119,   120,   121,   122,   123,   124,   125,   126,   127,   128 },

    {  129,   130,   131,   132,   133,   134,   135,   136,   137,   138,   139,   140,   141,   142,   143,   144 },
    {  145,   146,   147,   148,   149,   150,   151,   152,   153,   154,   155,   156,   157,   158,   159,   160 },
    {  161,   162,   163,   164,   165,   166,   167,   168,   169,   170,   171,   172,   173,   174,   175,   176 },
    {  177,   178,   179,   180,   181,   182,   183,   184,   185,   186,   187,   188,   189,   190,   191,   192 },

    {  193,   194,   195,   196,   197,   198,   199,   200,   201,   202,   203,   204,   205,   206,   207,   208 },
    {  209,   210,   211,   212,   213,   214,   215,   216,   217,   218,   219,   220,   221,   222,   223,   224 },
    {  225,   226,   227,   228,   229,   230,   231,   232,   233,   234,   235,   236,   237,   238,   239,   240 },
    {  241,   242,   243,   244,   245,   246,   247,   248,   249,   250,   251,   252,   253,   254,   255,   256 }
} };

const static Matrix B = { {
    {  357,   358,   359,   360,   361,   362,   363,   364,   365,   366,   367,   368,   369,   370,   371,   372 },
    {  373,   374,   375,   376,   377,   378,   379,   380,   381,   382,   383,   384,   385,   386,   387,   388 },
    {  389,   390,   391,   392,   393,   394,   395,   396,   397,   398,   399,   400,   401,   402,   403,   404 },
    {  405,   406,   407,   408,   409,   410,   411,   412,   413,   414,   415,   416,   417,   418,   419,   420 },
    {  421,   422,   423,   424,   425,   426,   427,   428,   429,   430,   431,   432,   433,   434,   435,   436 },
    {  437,   438,   439,   440,   441,   442,   443,   444,   445,   446,   447,   448,   449,   450,   451,   452 },
    {  453,   454,   455,   456,   457,   458,   459,   460,   461,   462,   463,   464,   465,   466,   467,   468 },
    {  469,   470,   471,   472,   473,   474,   475,   476,   477,   478,   479,   480,   481,   482,   483,   484 },
    {  485,   486,   487,   488,   489,   490,   491,   492,   493,   494,   495,   496,   497,   498,   499,   500 },
    {  501,   502,   503,   504,   505,   506,   507,   508,   509,   510,   511,   512,   513,   514,   515,   516 },
    {  517,   518,   519,   520,   521,   522,   523,   524,   525,   526,   527,   528,   529,   530,   531,   532 },
    {  533,   534,   535,   536,   537,   538,   539,   540,   541,   542,   543,   544,   545,   546,   547,   548 },
    {  549,   550,   551,   552,   553,   554,   555,   556,   557,   558,   559,   560,   561,   562,   563,   564 },
    {  565,   566,   567,   568,   569,   570,   571,   572,   573,   574,   575,   576,   577,   578,   579,   580 },
    {  581,   582,   583,   584,   585,   586,   587,   588,   589,   590,   591,   592,   593,   594,   595,   596 },
    {  597,   598,   599,   600,   601,   602,   603,   604,   605,   606,   607,   608,   609,   610,   611,   612 }
} };

const static Matrix AxB = { {
    { 70312, 70448, 70584, 70720, 70856, 70992, 71128, 71264, 71400, 71536, 71672, 71808, 71944, 72080, 72216, 72352 },
    { 192424, 192816, 193208, 193600, 193992, 194384, 194776, 195168, 195560, 195952, 196344, 196736, 197128, 197520, 197912, 198304 },
    { 314536, 315184, 315832, 316480, 317128, 317776, 318424, 319072, 319720, 320368, 321016, 321664, 322312, 322960, 323608, 324256 },
    { 436648, 437552, 438456, 439360, 440264, 441168, 442072, 442976, 443880, 444784, 445688, 446592, 447496, 448400, 449304, 450208 },
    { 558760, 559920, 561080, 562240, 563400, 564560, 565720, 566880, 568040, 569200, 570360, 571520, 572680, 573840, 575000, 576160 },
    { 680872, 682288, 683704, 685120, 686536, 687952, 689368, 690784, 692200, 693616, 695032, 696448, 697864, 699280, 700696, 702112 },
    { 802984, 804656, 806328, 808000, 809672, 811344, 813016, 814688, 816360, 818032, 819704, 821376, 823048, 824720, 826392, 828064 },
    { 925096, 927024, 928952, 930880, 932808, 934736, 936664, 938592, 940520, 942448, 944376, 946304, 948232, 950160, 952088, 954016 },
    { 1047208, 1049392, 1051576, 1053760, 1055944, 1058128, 1060312, 1062496, 1064680, 1066864, 1069048, 1071232, 1073416, 1075600, 1077784, 1079968 },
    { 1169320, 1171760, 1174200, 1176640, 1179080, 1181520, 1183960, 1186400, 1188840, 1191280, 1193720, 1196160, 1198600, 1201040, 1203480, 1205920 },
    { 1291432, 1294128, 1296824, 1299520, 1302216, 1304912, 1307608, 1310304, 1313000, 1315696, 1318392, 1321088, 1323784, 1326480, 1329176, 1331872 },
    { 1413544, 1416496, 1419448, 1422400, 1425352, 1428304, 1431256, 1434208, 1437160, 1440112, 1443064, 1446016, 1448968, 1451920, 1454872, 1457824 },
    { 1535656, 1538864, 1542072, 1545280, 1548488, 1551696, 1554904, 1558112, 1561320, 1564528, 1567736, 1570944, 1574152, 1577360, 1580568, 1583776 },
    { 1657768, 1661232, 1664696, 1668160, 1671624, 1675088, 1678552, 1682016, 1685480, 1688944, 1692408, 1695872, 1699336, 1702800, 1706264, 1709728 },
    { 1779880, 1783600, 1787320, 1791040, 1794760, 1798480, 1802200, 1805920, 1809640, 1813360, 1817080, 1820800, 1824520, 1828240, 1831960, 1835680 },
    { 1901992, 1905968, 1909944, 1913920, 1917896, 1921872, 1925848, 1929824, 1933800, 1937776, 1941752, 1945728, 1949704, 1953680, 1957656, 1961632 }
} };

bool operator==(const Matrix& lhs, const Matrix& rhs)
{
    for (size_t i = 0; i < 16; ++i) {
        for (size_t k = 0; k < 16; ++k) {
            if (lhs.data[i][k] != rhs.data[i][k]) {
                printf("Mismatch at (%d,%d): %f != %f\n", i, k, lhs.data[i][k], rhs.data[i][k]);
                return false;
            }
        }
    }

    return true;
}

template<typename Func>
void testMatMul(Func&& func)
{
    EXPECT_EQ(func(one, one), one);
    EXPECT_EQ(func(one, A), A);
    EXPECT_EQ(func(A, one), A);
    EXPECT_EQ(func(A, B), AxB);
}

// Demonstrate some basic assertions.
TEST(UnitTest, MultTest) {
    testMatMul(mult);
    testMatMul(mult_vec);
}

